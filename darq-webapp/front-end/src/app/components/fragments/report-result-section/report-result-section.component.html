<div class="card-block" fxLayout="column" fxLayoutAlign="start stretch" style="height: 100%;">
	<h4 class="card-title">{{section.title}}</h4>
	<span style="word-break: normal;">{{section.description}}</span>
	<div style="width: 100%; height : 100%; padding: 5px;" fxLayout="row" fxLayoutAlign="center stretch">
		<div fxFlex
			 style="border: 1px dashed black; padding: 10px; background-color: #ececec; margin-right: 5px; margin-top: 5px; height: 100%;"
			 *ngFor="let p of section.results" fxLayout="column" fxLayoutAlign="start stretch">
			<span style="text-align: center;"><strong> Analysis Type : </strong>{{typeName(p.type)}}</span>
			<mat-divider style="margin-bottom: 5px; margin-top: 5px;"></mat-divider>
			<div fxLayout="column" fxLayoutAlign="space-between stretch" style="height: 100%;">
				<div>
					<table *ngIf="p.filters && p.filters.length > 0" class="table table-striped table-sm"
						   style="text-align: center; border : 1px solid black; border-collapse : initial; background-color: white;">
						<thead>
						<tr>
							<th colspan="2">Sample Selection</th>
						</tr>
						</thead>
						<tbody>
						<tr *ngFor="let f of p.filters">
							<td>
								{{f.field}}
							</td>
							<td>
								{{value(f.field, f.value)}}
							</td>
						</tr>
						</tbody>
					</table>
					<table *ngIf="p.values" class="table table-striped table-sm"
						   style="text-align: center; border : 1px solid black; border-collapse : initial; background-color: white;"
						   #show="var" [var]="true">
						<thead>
						<tr>
							<th fxLayout="row" fxLayoutAlign="space-between center">
								Analysis Data (T)
								<i (click)="show.var = !show.var;"
								   [ngClass]="{'fa-eye' : show.var, 'fa-eye-slash' : !show.var}" class="fa float-right"
								   style="cursor : pointer; color: green;"></i>
							</th>
						</tr>
						</thead>
						<tbody *ngIf="!show.var" style="max-height: 400px; overflow: auto;">
						<tr *ngIf="p.groups && p.groups.length > 0" style="display: block; width: 100%;" fxLayout="row"
							fxLayoutAlign="space-between stretch">
							<td style="padding : 0px;">
								<p-table #tte
										 [globalFilterFields]="['value','threshold','flag'].concat(p.table.headers)"
										 [resizableColumns]="true" [value]="p.table.rows" [scrollable]="true"
										 [styleClass]="'table-sm'" scrollWidth="350px" scrollHeight="200px">
									<ng-template pTemplate="caption">
										<input type="text" pInputText size="50" placeholder="Filter"
											   (input)="tte.filterGlobal($event.target.value, 'contains')"
											   style="width:100%;">
									</ng-template>
									<ng-template pTemplate="header" let-columns>
										<tr>
											<th style="text-align: center;"  *ngFor="let h of p.table.headers" pResizableColumn>
												{{h}}
											</th>
											<th style="text-align: center;"  pResizableColumn> Value fgf</th>
											<th style="text-align: center;"  pResizableColumn> Threshold</th>
											<th style="text-align: center;"  pResizableColumn>Flag</th>
										</tr>
									</ng-template>
									<ng-template pTemplate="body" let-node>
										<tr>
											<td *ngFor="let h of p.table.headers">{{node[h] ? value(h, node[h]) : '*'}}</td>
											<td>{{node.value}}% ({{node.fraction.count + "/" + node.fraction.total}})</td>
											<td>{{node.threshold}}%</td>
											<td [ngStyle]="{'background-color' : node.flag === 'ABOVE' ? 'lightpink' : 'lightgreen'}">
												{{ node.flag }}
											</td>
										</tr>
									</ng-template>
								</p-table>
							</td>
						</tr>
						<tr *ngIf="!p.groups || p.groups.length === 0">
							<td>
								<span>Count based on Sample Selection</span>
								<span class="float-right">{{p.values['indicator'] ? percentage(p.values['indicator'])+'% (' + p.values['indicator'].count + '/' + p.values['indicator'].total + ')': 'No Data'}}</span>
							</td>
						</tr>
						</tbody>
					</table>
				</div>
				<ng-container *ngTemplateOutlet="template(p); context : {$implicit : p, data : p.chart}"> </ng-container>
			</div>
		</div>
	</div>
</div>


<ng-template #indicator let-payload>
	<div fxFlex="grow" fxLayout="column" fxLayoutAlign="center stretch"
		 *ngIf="payload.values && payload.values.indicator"
		 style="background-color: white; border: 1px solid black; padding: 10px;">
		<div fxLayout="row" fxLayoutAlign="start center">
			<strong>{{percentage(payload.values.indicator)+'%'}} ({{payload.values.indicator.count}} /
				{{payload.values.indicator.total}})</strong>
			<span class="badge badge-danger" style="margin-left : 5px;"
				  *ngIf="flag(payload.values.indicator, payload.display)">Over Threshold ({{payload.display.threshold}}%)</span>
		</div>
		<div fxLayout="column" style="min-width: 400px;" fxLayoutAlign="start stretch">
			<div class="progress" style="width: 100%; height: 40px; background-color: #a7d3e8 !important;">
				<div class="progress-bar progress-bar-striped" [ngStyle]="{'width' : payload.display.threshold + '%'}"
					 style="border-right : 1px solid red; height: 40px;"
					 *ngIf="flag(payload.values.indicator, payload.display)">

				</div>
				<div [ngClass]="{'bg-danger' : flag(payload.values.indicator, payload.display)}"
					 class="progress-bar progress-bar-striped" role="progressbar"
					 [ngStyle]="{width: (flag(payload.values.indicator, payload.display) ? (percentage(payload.values.indicator) - payload.display.threshold) : percentage(payload.values.indicator)) +'%'}"
					 style="height: 40px;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
			</div>
		</div>
	</div>
	<div fxFlex="grow" fxLayout="column" fxLayoutAlign="center stretch"
		 *ngIf="!payload.values || !payload.values.indicator"
		 style="background-color: lightgrey; text-align: center; border: dashed gray 1px; height: 100%; min-width: 600px;">
		<strong style="font-weight: bold; color: darkgray;">NO DATA</strong>
	</div>
</ng-template>
<ng-template #chart let-payload let-node="data">
	<div fxFlex="grow" [ngStyle]="{padding: '10px', width : '100%'}" fxLayout="column"
		 fxLayoutAlign="space-between center" style="background-color: white; border: 1px solid black;">
		<div style="width: 100%;">
			<mat-radio-group class="float-right" [(ngModel)]="payload.display.chartType" fxLayout="row"
							 fxLayoutAlign="start start" *ngIf="payload.distribution">
				<mat-radio-button style="margin-right: 5px;" value="bar">Bar Chart</mat-radio-button>
				<mat-radio-button value="pie">Pie Chart</mat-radio-button>
			</mat-radio-group>
		</div>
		<div fxFlex="grow" fxLayout="column" fxLayoutAlign="center center">
			<div style="min-width: 400px; width: 100%;">
				<google-chart [data]="{
				chartType : payload.display.chartType === 'pie' ? 'PieChart' : 'BarChart',
				dataTable : node,
				options : {
					height : payload.display.chartType !== 'pie' && node.length * 30 > 300 ? node.length * 30 : null,
					legend : {position: 'bottom'},
					hAxis : {
						maxValue : 100
					},
					series: [
						 {type: 'bars'},
						 {type: 'steppedArea'}
					]
				}

			}"></google-chart>
			</div>
		</div>
	</div>
</ng-template>
